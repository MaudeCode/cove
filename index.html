<!doctype html>
<html lang="en" style="background:#0a0a0b">
  <head>
    <meta charset="UTF-8" />

    <!-- Security Headers -->
    <!-- CSP: 'unsafe-inline' is needed for theme script to prevent FOUC. In production, use a hash or nonce. -->
    <meta http-equiv="Content-Security-Policy" content="
      default-src 'self';
      frame-src * blob: data:;
      script-src 'self' 'unsafe-inline';
      style-src 'self' 'unsafe-inline';
      img-src 'self' data: blob: https: http://127.0.0.1:* http://localhost:*;
      font-src 'self' data:;
      connect-src 'self' ws://* wss://* https:;
      worker-src 'self' blob:;
      form-action 'self';
      base-uri 'self';
    " />
    <meta http-equiv="X-Content-Type-Options" content="nosniff" />
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin" />

    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/manifest.json" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="description" content="A cozy WebUI for OpenClaw chat" />
    <meta name="theme-color" content="#0a0a0b" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Cove" />
    <title>Cove - OpenClaw WebUI</title>
    
    <!-- Theme initialization - runs before anything else -->
    <script>
      (function(){
        var PREF_KEY='cove:theme-preference';
        var CACHE_KEY='cove:theme-cache';
        var LIGHT={"--color-bg-primary":"#ffffff","--color-bg-secondary":"#f9fafb","--color-bg-surface":"#ffffff","--color-text-primary":"#111827","--color-text-secondary":"#4b5563","--color-accent":"#2563eb","--color-border":"#e5e7eb"};
        var DARK={"--color-bg-primary":"#0a0a0b","--color-bg-secondary":"#111113","--color-bg-surface":"#1f1f23","--color-text-primary":"#fafafa","--color-text-secondary":"#a1a1aa","--color-accent":"#3b82f6","--color-border":"#27272a"};
        var root=document.documentElement;
        
        try{
          var pref=JSON.parse(localStorage.getItem(PREF_KEY)||'{}');
          var selected=pref.selected||'system';
          var cached=JSON.parse(localStorage.getItem(CACHE_KEY)||'null');
          var colors=null;
          var appearance='dark';
          
          if(selected==='system'){
            var prefersDark=window.matchMedia('(prefers-color-scheme:dark)').matches;
            var themeId=prefersDark?(pref.darkTheme||'dark'):(pref.lightTheme||'light');
            if(cached&&cached.id===themeId){
              colors=cached.colors;
              appearance=cached.appearance;
            }else{
              colors=themeId==='light'?LIGHT:DARK;
              appearance=themeId==='light'?'light':'dark';
            }
          }else{
            if(cached&&cached.id===selected){
              colors=cached.colors;
              appearance=cached.appearance;
            }else if(selected==='light'){
              colors=LIGHT;
              appearance='light';
            }else{
              colors=DARK;
              appearance='dark';
            }
          }
          
          // Apply colors and background immediately
          if(colors){
            var bg=colors['--color-bg-primary'];
            root.style.background=bg;
            root.setAttribute('data-appearance',appearance);
            for(var k in colors){
              root.style.setProperty(k,colors[k]);
            }
          }
        }catch(e){
          // Keep default dark background on error
        }
      })();
    </script>
  </head>
  <body>
    <div id="app"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
